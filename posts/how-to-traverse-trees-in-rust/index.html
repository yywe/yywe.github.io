<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="How to Traverse Trees in Rust" /><meta name="author" content="Hulua" /><meta property="og:locale" content="en" /><meta name="description" content="Today learned some something new about Rust when trying to use Rust to traverse binary trees. There are some pattern differences while using Rust to traverse binary trees compared with other languages. One main difference is that Rust does not provide NULL (or Nil) pointer. The alternative to refer to a case without children is None of Option. Also the definition of TreeNode is somewhat different." /><meta property="og:description" content="Today learned some something new about Rust when trying to use Rust to traverse binary trees. There are some pattern differences while using Rust to traverse binary trees compared with other languages. One main difference is that Rust does not provide NULL (or Nil) pointer. The alternative to refer to a case without children is None of Option. Also the definition of TreeNode is somewhat different." /><link rel="canonical" href="https://yywe.github.io/posts/how-to-traverse-trees-in-rust/" /><meta property="og:url" content="https://yywe.github.io/posts/how-to-traverse-trees-in-rust/" /><meta property="og:site_name" content="Hulua" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-16T08:55:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to Traverse Trees in Rust" /><meta name="twitter:site" content="@Hulua" /><meta name="twitter:creator" content="@Hulua" /><meta name="google-site-verification" content="liMLPEFk1OeBj60sNB4ZWXljAWSaM_5PT6cFO3qH-kg" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Hulua"},"description":"Today learned some something new about Rust when trying to use Rust to traverse binary trees. There are some pattern differences while using Rust to traverse binary trees compared with other languages. One main difference is that Rust does not provide NULL (or Nil) pointer. The alternative to refer to a case without children is None of Option. Also the definition of TreeNode is somewhat different.","headline":"How to Traverse Trees in Rust","dateModified":"2023-08-04T20:45:52-04:00","url":"https://yywe.github.io/posts/how-to-traverse-trees-in-rust/","datePublished":"2023-07-16T08:55:00-04:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://yywe.github.io/posts/how-to-traverse-trees-in-rust/"},"@context":"https://schema.org"}</script><title>How to Traverse Trees in Rust | Hulua</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hulua"><meta name="application-name" content="Hulua"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/favicon.ico" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hulua</a></div><div class="site-subtitle font-italic">Welcome to my home page</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yywe" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/Hulua" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['stweiyy','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to Traverse Trees in Rust</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How to Traverse Trees in Rust</h1><div class="post-meta text-muted"><div> By <em> Hulua </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1689512100" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-07-16 </em> </span> <span> Updated <em class="timeago" data-ts="1691196352" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-08-04 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="893 words"> <em>4 min</em> read</span> <span> read by <em id="mypv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </em> visitor </span> <span><i class="far fa-thumbs-up fa-fw" id="thumbsupbtn" ></i> <span><em id="postshowtotraversetreesinrust" class="num_of_likes"></em></span> </span></div></div></div><div class="post-content"><p>Today learned some something new about Rust when trying to use Rust to traverse binary trees. There are some pattern differences while using Rust to traverse binary trees compared with other languages. One main difference is that Rust does not provide NULL (or Nil) pointer. The alternative to refer to a case without children is None of Option. Also the definition of TreeNode is somewhat different.</p><p>Letâ€™s first look at the tree node definition:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="p">,</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="p">,</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Here we can see we wrap the TreeNode inside a Box pointer. and outside the pointer we wrapped it in an Option, and we have a generic parameter T. Next, we can implment a utility function to create a leaf node as:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">leaf</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span> <span class="p">{</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">Box</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">Self</span> <span class="p">{</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">left</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
            <span class="n">right</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
        <span class="p">}))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>With that, we can implement a basic inorder traverse function:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">traverse_inorder1</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">impl</span> <span class="nf">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.left</span> <span class="p">{</span>
            <span class="n">left</span><span class="nf">.traverse_inorder1</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nf">f</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.value</span><span class="p">);</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.right</span> <span class="p">{</span>
            <span class="n">right</span><span class="nf">.traverse_inorder1</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In this version, we implement the <code class="language-plaintext highlighter-rouge">traverse_inorder1</code> function for the TreeNode, note the 2nd parameter is a closure with the form of ` f: &amp;mut impl FnMut(&amp;T)`, it means the function that will visit the value of the node. The function body is like other languages where we use recursion to traverse the tree.</p><p>So far, although there are some new things using Rust to traverse binary tree, what really makes things intersting is the usage of <code class="language-plaintext highlighter-rouge">ControlFlow</code>. In rust core, it is defined as:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>
<span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"control_flow_enum_type"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.55.0"</span><span class="nd">)]</span>
<span class="c">// ControlFlow should not implement PartialOrd or Ord, per RFC 3058:</span>
<span class="c">// https://rust-lang.github.io/rfcs/3058-try-trait-v2.html#traits-for-controlflow</span>
<span class="nd">#[derive(Debug,</span> <span class="nd">Clone,</span> <span class="nd">Copy,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">Hash)]</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">ControlFlow</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c">/// Move on to the next phase of the operation as normal.</span>
    <span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"control_flow_enum_type"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.55.0"</span><span class="nd">)]</span>
    <span class="nd">#[lang</span> <span class="nd">=</span> <span class="s">"Continue"</span><span class="nd">]</span>
    <span class="nf">Continue</span><span class="p">(</span><span class="n">C</span><span class="p">),</span>
    <span class="c">/// Exit the operation without running subsequent phases.</span>
    <span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"control_flow_enum_type"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.55.0"</span><span class="nd">)]</span>
    <span class="nd">#[lang</span> <span class="nd">=</span> <span class="s">"Break"</span><span class="nd">]</span>
    <span class="nf">Break</span><span class="p">(</span><span class="n">B</span><span class="p">),</span>
    <span class="c">// Yes, the order of the variants doesn't match the type parameters.</span>
    <span class="c">// They're in this order so that `ControlFlow&lt;A, B&gt;` &lt;-&gt; `Result&lt;B, A&gt;`</span>
    <span class="c">// is a no-op conversion in the `Try` implementation.</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In short, it provide one way to either continue something or break something. This enum has 2 generic parameters. B is for the case when we want to break the execution and return its value (type B), while for the case of continue execution, since usually no return value, so usually <code class="language-plaintext highlighter-rouge">C=()</code>.</p><p>Now given one requirement, inorder traverse the binary tree and stop whenever hit a negative node. Then what should we do?. Taking advantage of <code class="language-plaintext highlighter-rouge">ControlFlow</code>, we can change the closure like below:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>    <span class="k">pub</span> <span class="k">fn</span> <span class="n">traverse_inorder2</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">impl</span> <span class="nf">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ControlFlow</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ControlFlow</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.left</span> <span class="p">{</span>
            <span class="n">left</span><span class="nf">.traverse_inorder2</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nf">f</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.value</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.right</span> <span class="p">{</span>
            <span class="n">right</span><span class="nf">.traverse_inorder2</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nn">ControlFlow</span><span class="p">::</span><span class="nf">Continue</span><span class="p">(())</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>Here the function signature changed to <code class="language-plaintext highlighter-rouge">pub fn traverse_inorder2&lt;B&gt;(&amp;self, f: &amp;mut impl FnMut(&amp;T) -&gt; ControlFlow&lt;B&gt;) -&gt; ControlFlow&lt;B&gt; </code>, here we can the generic parameter B, which indicates the type to return when break (assume hit negative node), and the closure also return the <code class="language-plaintext highlighter-rouge">ControlFlow</code>, so as the whole function.</p><p>The whole test code is below:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">ops</span><span class="p">::</span><span class="n">ControlFlow</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="p">,</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">traverse_inorder1</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">impl</span> <span class="nf">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.left</span> <span class="p">{</span>
            <span class="n">left</span><span class="nf">.traverse_inorder1</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nf">f</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.value</span><span class="p">);</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.right</span> <span class="p">{</span>
            <span class="n">right</span><span class="nf">.traverse_inorder1</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">traverse_inorder2</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">impl</span> <span class="nf">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ControlFlow</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">ControlFlow</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.left</span> <span class="p">{</span>
            <span class="n">left</span><span class="nf">.traverse_inorder2</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nf">f</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.value</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.right</span> <span class="p">{</span>
            <span class="n">right</span><span class="nf">.traverse_inorder2</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nn">ControlFlow</span><span class="p">::</span><span class="nf">Continue</span><span class="p">(())</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">leaf</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span> <span class="p">{</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">Box</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">Self</span> <span class="p">{</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">left</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
            <span class="n">right</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
        <span class="p">}))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">node</span> <span class="o">=</span> <span class="n">TreeNode</span> <span class="p">{</span>
        <span class="n">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">left</span><span class="p">:</span> <span class="nn">TreeNode</span><span class="p">::</span><span class="nf">leaf</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">right</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="nn">Box</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">TreeNode</span> <span class="p">{</span>
            <span class="n">value</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">left</span><span class="p">:</span> <span class="nn">TreeNode</span><span class="p">::</span><span class="nf">leaf</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">right</span><span class="p">:</span> <span class="nn">TreeNode</span><span class="p">::</span><span class="nf">leaf</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">})),</span>
    <span class="p">};</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">sum1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">node</span><span class="nf">.traverse_inorder1</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="p">|</span><span class="n">val</span><span class="p">|</span> <span class="p">{</span>
        <span class="n">sum1</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"The sum1 is {}"</span><span class="p">,</span> <span class="n">sum1</span><span class="p">);</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">sum2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">res</span> <span class="o">=</span> <span class="n">node</span><span class="nf">.traverse_inorder2</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="p">|</span><span class="n">val</span><span class="p">|</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">*</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nn">ControlFlow</span><span class="p">::</span><span class="nf">Break</span><span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">sum2</span> <span class="o">+=</span> <span class="o">*</span><span class="n">val</span><span class="p">;</span>
            <span class="nn">ControlFlow</span><span class="p">::</span><span class="nf">Continue</span><span class="p">(())</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"The sum2 is {}"</span><span class="p">,</span> <span class="n">sum2</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"The res is {:?}"</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So, to break the execution when hit a negative node, we pass</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">&amp;</span><span class="k">mut</span> <span class="p">|</span><span class="n">val</span><span class="p">|</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">*</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nn">ControlFlow</span><span class="p">::</span><span class="nf">Break</span><span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">sum2</span> <span class="o">+=</span> <span class="o">*</span><span class="n">val</span><span class="p">;</span>
            <span class="nn">ControlFlow</span><span class="p">::</span><span class="nf">Continue</span><span class="p">(())</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>this closure to the function. This is an interesting way to control execution flow in Rust.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/rust/'>Rust</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/rust/" class="post-tag no-text-decoration" >rust</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How+to+Traverse+Trees+in+Rust+-+Hulua&url=https%3A%2F%2Fyywe.github.io%2Fposts%2Fhow-to-traverse-trees-in-rust%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How+to+Traverse+Trees+in+Rust+-+Hulua&u=https%3A%2F%2Fyywe.github.io%2Fposts%2Fhow-to-traverse-trees-in-rust%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyywe.github.io%2Fposts%2Fhow-to-traverse-trees-in-rust%2F&text=How+to+Traverse+Trees+in+Rust+-+Hulua" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script> $(function () { /*Get likes count*/ /*Only one element meet the condition thus safe to do so*/ var elemID = null; $(".num_of_likes").map(function () { elemID = $(this).attr("id") }); $.ajax({ url: 'https://my-api-service-344803.uc.r.appspot.com/apis/data/countlikes', type: 'GET', data: { "pids": [elemID] }, traditional: true, success: function (data) { $.each(data, function (key, val) { $('#' + key).text(val) }) }, error: function (xhr, textStatus) { console.log('error in ajax'); console.log(xhr); console.log(textStatus); } }); /*Get page visit count*/ var pageUrl = "/posts/how-to-traverse-trees-in-rust/"; $.ajax({ url: 'https://my-api-service-344803.uc.r.appspot.com/apis/pageviews', type: 'GET', data: { "path": pageUrl}, dataType: "json", success: function (data) { /*Due to history reason, url upper/lower case are different { "/posts/Go-Concurrency-Stop-Signal-And-Timeout/": 12, "/posts/go-concurrency-stop-signal-and-timeout/": 7 }, thus here justify*/ $.each(data, function (key, val) { if (key === pageUrl) { $('#mypv').text(val) } }) }, error: function (xhr, textStatus) { console.log('error in ajax'); console.log(xhr); console.log(textStatus); } }); /*Get IP address*/ var ipAddr = null; $.getJSON('https://api.db-ip.com/v2/free/self', function (data) { /* console.log(JSON.stringify(data, null, 2)); */ ipAddr = data.ipAddress }); /*Bind like button with click event*/ $('#thumbsupbtn').click(function () { if (ipAddr !== null && elemID !== null) { $.ajax({ url: 'https://my-api-service-344803.uc.r.appspot.com/apis/data/likeaction', type: 'POST', dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ "pid": elemID, "ip": ipAddr}), traditional: true, success: function (data) { $('#'+elemID).text(data.likenumber) }, error: function (xhr, textStatus) { console.log('error in ajax'); console.log(xhr); console.log(textStatus); } }) } }); }); </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/go-concurrency-write-concurrent-programs/">Go Concurrency - Write Concurrent Programs</a><li><a href="/posts/kubernetes-replicatset-controller/">Kubernetes ReplicaSet Controller Design Principle</a><li><a href="/posts/how-to-traverse-trees-in-rust/">How to Traverse Trees in Rust</a><li><a href="/posts/how-to-persist-your-ssh-session-in-remote-server/">How to Persist Your SSH Session in Remote Server</a><li><a href="/posts/a-better-way-to-debug-tidb-source-code/">A Better Way to Debug TiDB Source Code</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/debug/">debug</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/goroutine/">goroutine</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/source-code/">source code</a> <a class="post-tag" href="/tags/development-environment/">development environment</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/tidb/">TiDB</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/how-to-persist-your-ssh-session-in-remote-server/"><div class="card-body"> <em class="timeago small" data-ts="1690635300" > 2023-07-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Persist Your SSH Session in Remote Server</h3><div class="text-muted small"><p> One of the major advatanage of developing server side applications in your local enviornment is that the terminal session never gets disconnected. The session is always available. 1 2 3 4 5 6 7 8 ...</p></div></div></a></div><div class="card"> <a href="/posts/kubernetes-replicatset-controller/"><div class="card-body"> <em class="timeago small" data-ts="1651064100" > 2022-04-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kubernetes ReplicaSet Controller Design Principle</h3><div class="text-muted small"><p> In kubernetes, controllers play a vital role to orchestrate resources. For beginners learning kubernetes, we need to understand what are controllers. In short, controllers manipulate resources. In ...</p></div></div></a></div><div class="card"> <a href="/posts/a-better-way-to-debug-tidb-source-code/"><div class="card-body"> <em class="timeago small" data-ts="1649422500" > 2022-04-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A Better Way to Debug TiDB Source Code</h3><div class="text-muted small"><p> TiDB is an interesting SQL database written in Golang. One major difference compared with popular exsiting relational databases is that in TiDB storage is separated as an independant runtime. The d...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/kubernetes-replicatset-controller/" class="btn btn-outline-primary" prompt="Older"><p>Kubernetes ReplicaSet Controller Design Principle</p></a> <a href="/posts/how-to-persist-your-ssh-session-in-remote-server/" class="btn btn-outline-primary" prompt="Newer"><p>How to Persist Your SSH Session in Remote Server</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://yywe.github.io/posts/how-to-traverse-trees-in-rust/'; this.page.identifier = '/posts/how-to-traverse-trees-in-rust/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://hulua-tech-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> <span>Welcome, the site has been visited <em id="my_pv_from_google" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </em> times.</p><p class="mb-0"> Â© 2023 <a href="https://twitter.com/#">Hulua</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer><script> $(function () { /*Get approximate page visit count using path */ pageUrlroot = "/"; $.ajax({ url: 'https://my-api-service-344803.uc.r.appspot.com/apis/pageviews', type: 'GET', data: { "path": "/"}, dataType: "json", success: function (data) { $.each(data, function (key, val) { if (key === pageUrlroot) { $('#my_pv_from_google').text(val) } }) }, error: function (xhr, textStatus) { console.log('error in ajax'); console.log(xhr); console.log(textStatus); } }); }); </script></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/debug/">debug</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/goroutine/">goroutine</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/source-code/">source code</a> <a class="post-tag" href="/tags/development-environment/">development environment</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/tidb/">TiDB</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-SL395S6583"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SL395S6583'); }); </script>
